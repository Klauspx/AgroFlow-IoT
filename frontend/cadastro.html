<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro - AgroFlow</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/reset.css" />
    <style>
      /* Mantive o seu estilo inline de cabeçalho para garantir */
      .header-bar { width: 100%; background: #6fa64f; height: 60px; border-radius: 8px; display: flex; justify-content: center; align-items: center; margin-bottom: 0.5rem; position: relative; }
      .header-logo { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); height: 85px; width: auto; z-index: 10; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
      .header-title { color: white; font-size: 1.4rem; font-weight: 700; margin: 0; text-shadow: 0 1px 2px rgba(0,0,0,0.2); margin-left: 30px; }
      .btn-back { display: block; margin-bottom: 15px; color: #1e3f9f; text-decoration: none; font-size: 2.5rem; font-weight: bold; line-height: 1; width: fit-content; transition: transform 0.2s; padding: 0 5px; }
      .btn-back:hover { transform: translateX(-3px); }
    </style>
  </head>
  <body>
    <div class="app-root">
      <div class="login-box">
        
        <header class="header-bar">
          <img src="img/logo-agroflow.png" class="header-logo" alt="Logo" />
          <span class="header-title">Cadastro</span>
        </header>

        <a href="index.html" class="btn-back" title="Voltar">&#8249;</a>

        <form class="login-form" onsubmit="fazerCadastro(event)">
          <input type="text" id="nome" placeholder="Nome Completo" required />
          <input type="email" id="email" placeholder="E-mail" required />
          <input type="email" id="email-conf" placeholder="Confirme seu E-mail" required />
          <input type="tel" id="telefone" placeholder="Telefone" required />
          <input type="text" id="cpf" placeholder="CPF" required />
          <input type="password" id="senha" placeholder="Senha" required />
          <input type="password" id="senha-conf" placeholder="Confirme sua senha" required />

          <button type="submit" class="btn-primary">Cadastrar</button>

          <div class="checkbox">
            <input type="checkbox" id="termos" required />
            <label for="termos">
              Aceito os termos de <a href="#" class="link"><span>Política de privacidade</span></a>
            </label>
          </div>
        </form>
      </div>
    </div>

    <script>
      // --- COLOQUE SEU LINK DO TÚNEL AQUI ---
      const API_URL = "http://localhost:8080/api"; 

      async function fazerCadastro(event) {
        event.preventDefault(); // Impede a página de recarregar

        // Pega os valores dos campos
        const nome = document.getElementById('nome') ? document.getElementById('nome').value : '';
        // ATENÇÃO: Verifique se no seu HTML o input de email tem id="email"
        const email = document.querySelector('input[type="email"]').value; 
        const senha = document.querySelectorAll('input[type="password"]')[0].value;
        const senhaConf = document.querySelectorAll('input[type="password"]')[1].value;

        if (senha !== senhaConf) {
            alert("As senhas não conferem!");
            return;
        }

        // Cria o objeto usuário
        const usuario = {
            nome: nome,
            email: email,
            senha: senha
            // Adicione telefone/cpf se o seu Java esperar por eles
        };

        try {
            const response = await fetch(`${API_URL}/usuarios`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(usuario)
            });

            if (response.ok) {
                alert("Cadastro realizado com sucesso!");
                window.location.href = "index.html"; // Manda para o login
            } else {
                const textoErro = await response.text();
                alert("Erro ao cadastrar: " + textoErro);
            }
        } catch (error) {
            console.error(error);
            alert("Erro de conexão. O backend está rodando?");
        }
      }
      
      // Conecta a função ao formulário
      const form = document.querySelector('form');
      if(form) form.addEventListener('submit', fazerCadastro);
    </script>
  </body>
</html>